<ng-template #itemTemplate let-item="item.value" let-index="index">
  <div nz-col  nzSpan="24" class="field_edit">
    <div nz-col  nzSpan="2">{{index + 1}}</div>
    <div nz-col  nzSpan="5">
      {{item.fieldKey}}
    </div>
    <div nz-col  nzSpan="6">
      {{item.fieldType == '0'?'固定值':'商品表字段'}}
    </div>
    <div nz-col  nzSpan="7">
      <div class="field_value_show" [innerHtml]="item.fieldValue"></div>
    </div>
    <div nz-col  nzSpan="4">
      <div nz-col  nzSpan="12">
        <button nz-button nzType="primary" (click)="showModel(item)">
          <i class="anticon anticon-edit" ></i>
        </button>
      </div>
      <div nz-col  nzSpan="12">
        <button nz-button nzType="primary" nz-popconfirm
                nzTitle="确认删除" nzOkText="确认" nzCancelText="取消"
                (nzOnConfirm)="deleteField(item,index)"
        ><i class="anticon anticon-delete"></i>
        </button>
      </div>
    </div>
  </div>
</ng-template>

<div nz-row>
  <div nz-col nzSpan="24" class="field_table">
    <div nz-col  nzSpan="24" class="field_table_header">
      <div nz-col  nzSpan="2">
        序号
      </div>
      <div nz-col  nzSpan="5">
        表头
      </div>
      <div nz-col  nzSpan="6">
        字段类型
      </div>
      <div nz-col  nzSpan="7">
        字段值
      </div>
      <div nz-col  nzSpan="4" style="">
        <div>
          <button nz-button nzType="primary" (click)="showModel()">
            <i class="anticon anticon-plus"></i></button>
        </div>
      </div>
    </div>
    <div nz-col  nzSpan="24" class="field_table_body">
      <bs-sortable
        (onChange) = "onChangeSorTable($event)"
        [(ngModel)]="fieldList"
        [itemTemplate]="itemTemplate"
        itemClass="sortable-item"
        itemActiveClass="sortable-item-active"
        placeholderClass="placeholderStyle"
        wrapperClass="sortable-wrapper"
      ></bs-sortable>
      <!--<pre class="code-preview">model: {{ itemObjectsLeft | json }}</pre>-->
    </div>
  </div>
</div>


<nz-modal [nzMaskClosable]="false"
          [nzStyle]="{'top':'55px'}"
          [nzBodyStyle]="{ 'background-color':'rgba(212, 202, 243, 0.11)'}"
          [(nzVisible)]="isVisible" [nzTitle]="modalTitle"
          [nzContent]="modalBody" [nzFooter]="modalFooter"
          (nzOnCancel)="handleCancel()">
  <ng-template #modalTitle>
    <h3 style="margin-bottom:0">{{ selectFielDetail.csvFieldId == null?'新增':'编辑'}}字段</h3>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">取消</button>
    <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="">确认</button>
  </ng-template>
</nz-modal>

<ng-template #modalBody>
  <div nz-row>
    <div nz-col nzSpan="24" style="margin-bottom:10px">
      <div nz-col nzSpan="12">
        <span class="span_label_title">表头:</span>
        <input class="span_input" nz-input  [(ngModel)]="selectFielDetail.fieldKey">
      </div>
      <div nz-col nzSpan="12">
        <nz-radio-group [(ngModel)]="selectFielDetail.fieldType">
          <label nz-radio nzValue="0">固定值</label>
          <label nz-radio nzValue="1">商品表字段</label>
        </nz-radio-group>
      </div>
    </div>
    <div nz-col nzSpan="24">
      <div nz-col nzSpan="11">
        <div class="field_div_height">
          <h3>表字段</h3>
          <div class="list-height-auto" itemNum="{{data?.length*5 }}">
            <nz-list [nzDataSource]="data"
                     nzBordered
                     nzSize="small"
                     [nzRenderItem]="item">
              <ng-template #item let-item>
                <nz-list-item (click)="clickFun(item,0)" [nzContent]="item.sysNm"></nz-list-item>
              </ng-template>
            </nz-list>
          </div>
          <h3>自定义公式</h3>
          <div class="list-height-auto" itemNum="{{csvCustomFields?.length*5 }}">
            <nz-list [nzDataSource]="csvCustomFields"
                     nzBordered
                     nzSize="small"
                     [nzRenderItem]="item">
              <ng-template #item let-item>
                <nz-list-item (click)="clickFun(item,1)" [nzContent]="item.cfieldNm"></nz-list-item>
              </ng-template>
            </nz-list>
          </div>
        </div>
      </div>
      <div nz-col nzSpan="2"></div>
      <div nz-col nzSpan="11">
        <div class="field_div_height">
          <div editDiv="true" class="field_input_div" #editDiv1
                (keyup)="saveRange()"
                (click)="saveRange();"
                contenteditable="true"></div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
